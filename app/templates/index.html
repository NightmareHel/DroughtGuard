{% extends "base.html" %}

{% block title %}DroughtGuard - Food Insecurity Early Warning{% endblock %}

{% block content %}
<div class="container">
    <div class="sidebar">
        <div class="region-selector">
            <label for="region-select">Select Region:</label>
            <select id="region-select">
                <option value="">-- Select a region --</option>
            </select>
        </div>
        
        <button id="predict-btn" class="predict-btn">Predict Risk</button>
        
        <div id="results" class="results-panel">
            <h3>Instructions</h3>
            <p>Select a region from the dropdown and click "Predict Risk" to see the food insecurity prediction.</p>
        </div>
        
        <div id="ai-advisor-section" class="ai-advisor-panel" style="display: none;">
            <h3>AI Advisor</h3>
            <div class="ai-mode-toggle">
                <button id="btn-explain" class="ai-btn ai-btn-active">Explain</button>
                <button id="btn-brief" class="ai-btn">Brief</button>
            </div>
            <div id="ai-text" class="ai-text-container">
                <em>Loading AI explanation...</em>
            </div>
            <div id="ai-cached-badge" class="ai-cached-badge" style="display: none;">
                ðŸ’¾ Cached
            </div>
        </div>
    </div>
    
    <div class="map-container">
        <div id="map"></div>
        
        <div class="legend">
            <h4>Risk Levels</h4>
            <div class="legend-item">
                <span class="legend-color" style="background-color: #28a745;"></span>
                <span>Low</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background-color: #ffc107;"></span>
                <span>Moderate</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background-color: #dc3545;"></span>
                <span>High</span>
            </div>
        </div>
    </div>
</div>

<script>
// Load regions on page load
fetch('/api/regions')
    .then(response => response.json())
    .then(data => {
        const select = document.getElementById('region-select');
        data.regions.forEach(region => {
            const option = document.createElement('option');
            option.value = region;
            option.textContent = region;
            select.appendChild(option);
        });
    })
    .catch(error => console.error('Error loading regions:', error));
</script>
{% endblock %}
